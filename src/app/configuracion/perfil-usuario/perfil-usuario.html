<div class="perfil-container">
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1>Perfil de Usuario</h1>
        <p>Gestiona tu información personal</p>
      </div>
      <div class="header-actions">
        <button 
          class="btn-secondary" 
          routerLink="/configuracion">
          <span class="material-icons">arrow_back</span>
          Volver
        </button>
      </div>
    </div>
  </div>

  <div class="main-content">
    <!-- Avatar Section -->
    <div class="avatar-section">
      <div class="avatar-container">
        <div class="avatar-circle" *ngIf="!configuracion?.avatar">
          <span class="avatar-initials">{{ obtenerIniciales(configuracion?.nombre || 'Usuario') }}</span>
        </div>
        <img 
          *ngIf="configuracion?.avatar" 
          [src]="configuracion?.avatar" 
          alt="Avatar" 
          class="avatar-image">
        <div class="avatar-overlay" *ngIf="isEditing">
          <span class="material-icons">camera_alt</span>
        </div>
      </div>
      <h2>{{ configuracion?.nombre || 'Usuario' }}</h2>
      <p class="member-since">Miembro desde {{ formatearFecha(configuracion?.fechaCreacion || getFechaActual()) }}</p>
    </div>

    <!-- Form Section -->
    <div class="form-section">
      <div class="form-header">
        <h3>Información Personal</h3>
        <button 
          *ngIf="!isEditing"
          class="btn-edit" 
          (click)="toggleEdit()">
          <span class="material-icons">edit</span>
          Editar
        </button>
      </div>

      <!-- Success/Error Messages -->
      <div class="message success" *ngIf="mensajeExito">
        <span class="material-icons">check_circle</span>
        {{ mensajeExito }}
      </div>
      
      <div class="message error" *ngIf="mensajeError">
        <span class="material-icons">error</span>
        {{ mensajeError }}
      </div>

      <form [formGroup]="perfilForm" (ngSubmit)="guardarPerfil()">
        <div class="form-grid">
          <!-- Left Column -->
          <div class="form-column">
            <div class="form-group">
              <label for="nombre">Nombre Completo *</label>
              <input 
                type="text" 
                id="nombre" 
                formControlName="nombre"
                [readonly]="!isEditing"
                placeholder="Ingresa tu nombre completo"
                [class.readonly]="!isEditing">
            </div>

            <div class="form-group">
              <label for="email">Correo Electrónico *</label>
              <input 
                type="email" 
                id="email" 
                formControlName="email"
                [readonly]="!isEditing"
                placeholder="tu@email.com"
                [class.readonly]="!isEditing">
            </div>

            <div class="form-group">
              <label for="telefono">Teléfono</label>
              <input 
                type="tel" 
                id="telefono" 
                formControlName="telefono"
                [readonly]="!isEditing"
                placeholder="+57 300 123 4567"
                [class.readonly]="!isEditing">
            </div>
          </div>

          <!-- Right Column -->
          <div class="form-column">
            <div class="form-group">
              <label for="fechaNacimiento">Fecha de Nacimiento</label>
              <input 
                type="date" 
                id="fechaNacimiento" 
                formControlName="fechaNacimiento"
                [readonly]="!isEditing"
                [class.readonly]="!isEditing">
            </div>

            <div class="form-group">
              <label for="avatar">URL del Avatar</label>
              <input 
                type="url" 
                id="avatar" 
                formControlName="avatar"
                [readonly]="!isEditing"
                placeholder="https://ejemplo.com/avatar.jpg"
                [class.readonly]="!isEditing">
            </div>

            <div class="form-group">
              <label>Última Actualización</label>
              <div class="readonly-field">
                {{ formatearFecha(configuracion?.ultimaActualizacion || getFechaActual()) }}
              </div>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions" *ngIf="isEditing">
          <button 
            type="button" 
            class="btn-cancel" 
            (click)="toggleEdit()"
            [disabled]="isLoading">
            Cancelar
          </button>
          <button 
            type="submit" 
            class="btn-save"
            [disabled]="isLoading || perfilForm.invalid">
            <span class="material-icons" *ngIf="!isLoading">save</span>
            <span class="material-icons" *ngIf="isLoading">hourglass_empty</span>
            {{ isLoading ? 'Guardando...' : 'Guardar Cambios' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
