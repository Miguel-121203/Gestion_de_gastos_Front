<div class="consulta-gastos-container">

  <!-- 🧭 Encabezado -->
  <header class="page-header">
    <div class="header-content">
      <h1 class="title">📊 Consulta de Gastos</h1>
      <button class="btn btn-regresar" routerLink="/gastos">
        ← Regresar
      </button>
    </div>
  </header>

  <!-- 🔄 Indicador de carga -->
  <div class="loading-container" *ngIf="loading">
    <div class="spinner"></div>
    <p>Cargando gastos...</p>
  </div>

  <!-- ⚠️ Mensaje de error -->
  <div class="error-container" *ngIf="error && !loading">
    <div class="error-icon">⚠️</div>
    <h3>{{ error }}</h3>
    <button class="btn btn-primary" (click)="cargarGastos()">
      🔄 Reintentar
    </button>
  </div>

  <!-- Contenido principal -->
  <ng-container *ngIf="!loading && !error">

    <!-- 🔍 Sección de Filtros -->
    <section class="filtros-section">
      <h2 class="section-title">🔍 Filtros de Búsqueda</h2>
      <div class="filtros-grid">

        <!-- Filtro por descripción -->
        <div class="filtro-group">
          <label for="descripcion-filtro">📝 Descripción:</label>
          <div class="input-container">
            <input
              type="text"
              id="descripcion-filtro"
              [(ngModel)]="descripcionFiltro"
              (input)="aplicarFiltros()"
              placeholder="Buscar por descripción..."
              class="input-field">

          </div>
        </div>

        <!-- Filtro por fecha -->
        <div class="filtro-group">
          <label for="fecha-filtro">📅 Fecha:</label>
          <div class="input-container">
            <input
              type="date"
              id="fecha-filtro"
              [(ngModel)]="fechaFiltro"
              (change)="aplicarFiltros()"
              class="input-field">
            <button
              type="button"
              class="btn-icon btn-clear"
              (click)="limpiarFecha()"
              *ngIf="fechaFiltro"
              title="Limpiar fecha">
              ✖
            </button>
          </div>
        </div>

      </div>

      <!-- Botón limpiar todos los filtros -->
      <div class="filtros-actions">
        <button
          class="btn btn-limpiar"
          (click)="limpiarFiltros()"
          *ngIf="descripcionFiltro || fechaFiltro">
          ✨ Limpiar Todos los Filtros
        </button>
      </div>
    </section>

    <!-- 📊 Resumen de resultados -->
    <section class="resumen-section" *ngIf="gastosFiltrados.length > 0">
      <div class="resumen-card">
        <span class="resumen-label">📋 Total de gastos</span>
        <span class="resumen-value">{{ gastosFiltrados.length }}</span>
      </div>

      <div class="resumen-card highlight">
        <span class="resumen-label">💰 Monto total</span>
        <span class="resumen-value total">${{ calcularTotal() | number:'1.2-2' }}</span>
      </div>
    </section>

    <!-- 📋 Tabla de Gastos -->
    <section class="tabla-container" *ngIf="gastosFiltrados.length > 0">
      <div class="table-wrapper">
        <table class="gastos-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Fecha</th>
              <th>Categoría</th>
              <th>Descripción</th>
              <th>Monto</th>
              <th>Usuario</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let gasto of gastosFiltrados; let i = index"
                [class.even]="i % 2 === 0"
                [class.inactive]="!gasto.active">
              <td data-label="ID" class="id-cell">
                #{{ gasto.expenseId }}
              </td>
              <td data-label="Fecha" class="fecha-cell">
                {{ gasto.expenseDate | date:'dd/MM/yyyy' }}
              </td>
              <td data-label="Categoría" class="categoria-cell">
                <span class="categoria-badge">
                  Categoría {{ gasto.expenseCategoryId }}
                </span>
              </td>
              <td data-label="Descripción" class="descripcion-cell">
                {{ gasto.description }}
              </td>
              <td data-label="Monto" class="monto-cell">
                ${{ gasto.amount | number:'1.2-2' }}
              </td>
              <td data-label="Usuario" class="usuario-cell">
                👤 Usuario {{ gasto.userId }}
              </td>
        
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- 📭 Mensaje cuando no hay resultados con filtros -->
    <div class="no-data" *ngIf="gastosFiltrados.length === 0 && gastos.length > 0">
      <div class="no-data-icon">🔍</div>
      <h3>No se encontraron gastos</h3>
      <p>No hay gastos que coincidan con los filtros aplicados</p>
      <button class="btn btn-primary" (click)="limpiarFiltros()">
        🗑️ Limpiar filtros
      </button>
    </div>

    <!-- 📭 Mensaje cuando no hay datos en absoluto -->
    <div class="no-data" *ngIf="gastos.length === 0">
      <div class="no-data-icon">📊</div>
      <h3>No hay gastos registrados</h3>
      <p>Comienza agregando tu primer gasto</p>
      <button class="btn btn-primary" routerLink="/gastos/nuevo">
        ➕ Agregar Gasto
      </button>
    </div>

  </ng-container>

</div>
